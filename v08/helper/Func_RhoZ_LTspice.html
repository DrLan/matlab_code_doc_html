<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of Func_RhoZ_LTspice</title>
  <meta name="keywords" content="Func_RhoZ_LTspice">
  <meta name="description" content="% example usage: copy the code inside &quot; if 1==0  ... end&quot; and run.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">v08</a> &gt; <a href="index.html">helper</a> &gt; Func_RhoZ_LTspice.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for v08\helper&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>Func_RhoZ_LTspice
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>% example usage: copy the code inside &quot; if 1==0  ... end&quot; and run.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function rho = Func_RhoZ_LTspice(NetList,fibermat,fiberLen,beta,fiberRadius,NumBreak,Rc,rf,RBreakage) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">% example usage: copy the code inside &quot; if 1==0  ... end&quot; and run.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../v08/@Function/Func_RhoZ_LTspice.html" class="code" title="function rho = Func_RhoZ_LTspice(NetList,fibermat,fiberLen,beta,fiberRadius,NumBreak,Rc,rf,RBreakage)">Func_RhoZ_LTspice</a>	% example usage: copy the code inside " if 1==0  ... end" and run.</li><li><a href="../../v08/@Function/ReadRAW.html" class="code" title="function [Vin,data,data1]=ReadRAW(infile)">ReadRAW</a>	function [LineContent,NVariables, NValues] = ReadRAW(filepath)</li><li><a href="Func_RhoZ_LTspice.html" class="code" title="function rho = Func_RhoZ_LTspice(NetList,fibermat,fiberLen,beta,fiberRadius,NumBreak,Rc,rf,RBreakage)">Func_RhoZ_LTspice</a>	% example usage: copy the code inside " if 1==0  ... end" and run.</li><li><a href="ReadRAW.html" class="code" title="function [Vin,data,data1]=ReadRAW(infile)">ReadRAW</a>	function [LineContent,NVariables, NValues] = ReadRAW(filepath)</li><li><a href="createnode.html" class="code" title="function [ nodes ] = createnode( fiber,ref,perc,N )">createnode</a>	UNTITLED2 Summary of this function goes here</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../v08/@Function/Func_RhoZ_LTspice.html" class="code" title="function rho = Func_RhoZ_LTspice(NetList,fibermat,fiberLen,beta,fiberRadius,NumBreak,Rc,rf,RBreakage)">Func_RhoZ_LTspice</a>	% example usage: copy the code inside " if 1==0  ... end" and run.</li><li><a href="../../v08/@Function/Function.html" class="code" title="">Function</a>	</li><li><a href="Func_RhoZ_LTspice.html" class="code" title="function rho = Func_RhoZ_LTspice(NetList,fibermat,fiberLen,beta,fiberRadius,NumBreak,Rc,rf,RBreakage)">Func_RhoZ_LTspice</a>	% example usage: copy the code inside " if 1==0  ... end" and run.</li><li><a href="RNetworkGUI1.html" class="code" title="function varargout = RNetworkGUI1(varargin)">RNetworkGUI1</a>	RNETWORKGUI1 MATLAB code for RNetworkGUI1.fig</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function rho = Func_RhoZ_LTspice(NetList,fibermat,fiberLen,beta,fiberRadius,NumBreak,Rc,rf,RBreakage)</a>
0002 
0003 <span class="comment">%% example usage: copy the code inside &quot; if 1==0  ... end&quot; and run.</span>
0004 <span class="keyword">if</span> 1==0
0005     clear all
0006     NetList=<span class="string">'testFunc_RhoZ_LTspice3'</span>;
0007     fiberLen=1e-3;
0008     beta=350;
0009     fiberRadius=7e-6;
0010     NumBreak=0;
0011     Rc=10;
0012     rf=1.5e-5;
0013     RBreakage=10000;
0014     fibermat=<span class="string">'vf_0.6_spec2.mat'</span>;
0015     rho =<a href="Func_RhoZ_LTspice.html" class="code" title="function rho = Func_RhoZ_LTspice(NetList,fibermat,fiberLen,beta,fiberRadius,NumBreak,Rc,rf,RBreakage)">Func_RhoZ_LTspice</a>(NetList,fibermat,fiberLen,beta,fiberRadius,NumBreak,Rc,rf,RBreakage)
0016 <span class="keyword">end</span>
0017 
0018 <span class="comment">%% write Model head</span>
0019 <span class="comment">%NetList='testMatlab2LTspice8';</span>
0020 NetListID= [NetList,<span class="string">'.cir'</span>];
0021 fid=fopen(NetListID,<span class="string">'wt'</span>); <span class="comment">% wt means overwrite existing file named with NetListID</span>
0022 <span class="comment">% To open a file in text mode, append 't' to the permission string,</span>
0023 fprintf(fid,<span class="string">'%s  \n'</span>,<span class="string">'Resistor Network for Cross-Ply CFRP'</span>);
0024 fclose(fid);
0025 NetListMatrix = [];
0026 <span class="comment">%fiberLen=1e-3;</span>
0027 <span class="comment">%beta=350;</span>
0028 <span class="comment">%fiberRadius=7e-6;</span>
0029 <span class="comment">%NumBreak=0;</span>
0030 <span class="comment">%Rc=10;</span>
0031 <span class="comment">%rf=1.5e-5;</span>
0032 <span class="comment">%RBreakage=10000;</span>
0033 
0034 NumContacts=0;
0035 <span class="comment">%load('vf_0.6_spec2.mat'); % changed from fibermat to 'vf_0.6_spec2.mat'</span>
0036 &lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
0037 load (fibermat);
0038 =======
0039 
0040 load(fibermat);
0041 <span class="comment">%fiber=fibermat;</span>
0042 &gt;&gt;&gt;&gt;&gt;&gt;&gt; 558d32ba490f1fcd4af42dcc54ca0581b61ef031
0043 <span class="comment">% Note: after load(fibermat), fiber.x fiber.y fiber.z are all row vectors.</span>
0044 <span class="comment">% Code below change row vectors into column vectors.</span>
0045 fiber.x=fiber.x';
0046 fiber.y=fiber.y';
0047 fiber.radius=fiber.radius';
0048 <span class="comment">% Now fiber.x fiber.y and fiber.radius are column vectors.</span>
0049 N=size(fiber.radius,1);<span class="comment">%</span>
0050 <span class="comment">% !!! be careful, depending on the fiber.radius being a row vector or</span>
0051 <span class="comment">% column vector, this command can be size(...,2) for row vector</span>
0052 <span class="comment">%or size(...,1) for column vectors.</span>
0053 fiber1= struct(<span class="string">'center'</span>,[], <span class="string">'radius'</span>,[], <span class="string">'nodes'</span>, []);
0054 aveRad=mean(fiber.radius);
0055 scale=aveRad/fiberRadius;
0056 
0057 fiber.x=fiber.x/scale;
0058 fiber.y=fiber.y/scale;
0059 fiber.radius=fiber.radius/scale;
0060 <span class="comment">%% get VF and a</span>
0061 minx=min(fiber.x)-fiberRadius;
0062 miny=min(fiber.y)-fiberRadius;
0063 maxx=max(fiber.x)+fiberRadius;
0064 maxy=max(fiber.y)+fiberRadius;
0065 xlen=maxx-minx;
0066 ylen=maxy-miny;
0067 <span class="comment">% xlen=maxx-minx-2*fiberRadius;</span>
0068 <span class="comment">% ylen=maxy-miny-2*fiberRadius;</span>
0069 Rsquare=fiber.radius'*fiber.radius;
0070 VF=pi*Rsquare/(xlen*ylen);
0071 <span class="comment">%a=fiberRadius*(sqrt(pi/(VF))-2); % square packing</span>
0072 <span class="comment">% a=fiberRadius*(sqrt(2*pi/(sqrt(3)*VF))-2); % hex packing</span>
0073 <span class="comment">%% plot</span>
0074 <span class="comment">% clf</span>
0075 <span class="comment">% hold on</span>
0076 <span class="comment">% viscircles([fiber.x fiber.y],fiber.radius,'LineWidth',2);</span>
0077 <span class="comment">% axis([minx maxx miny maxy]);</span>
0078 <span class="comment">%% restruct data</span>
0079 <span class="keyword">for</span> i=1:N
0080     fiber1(i).center(1)=fiber.x(i);
0081     fiber1(i).center(2)=fiber.y(i);
0082     fiber1(i).radius=fiber.radius(i);
0083 <span class="keyword">end</span>
0084 fiber=fiber1;
0085 <span class="comment">%% find fiber neigbbors</span>
0086 perc=1.8*fiberRadius;
0087 <span class="keyword">for</span> i=1:N
0088     fiber(i).nodes=<a href="createnode.html" class="code" title="function [ nodes ] = createnode( fiber,ref,perc,N )">createnode</a>(fiber,i,perc,N);
0089 <span class="keyword">end</span>
0090 <span class="comment">% finish creating neighbors</span>
0091 <span class="comment">% find floating fibers that are not connected to any fibers</span>
0092 nullnodes=[];
0093 <span class="keyword">for</span> i=1:N
0094     <span class="keyword">if</span> size(fiber(i).nodes,2)==0
0095         nullnodes(end+1)=i;
0096     <span class="keyword">end</span>
0097 <span class="keyword">end</span>
0098 <span class="keyword">while</span> ~isempty(nullnodes)
0099     fiber(nullnodes(1))=[];
0100     N1=size(fiber,2);
0101     <span class="keyword">for</span> i=1:N1
0102         fiber(i).nodes=<a href="createnode.html" class="code" title="function [ nodes ] = createnode( fiber,ref,perc,N )">createnode</a>(fiber,i,perc,N1);
0103     <span class="keyword">end</span>
0104     nullnodes=[];
0105     <span class="keyword">for</span> i=1:N1
0106         <span class="keyword">if</span> size(fiber(i).nodes,2)==0
0107             nullnodes(end+1)=i;
0108         <span class="keyword">end</span>
0109     <span class="keyword">end</span>
0110 <span class="keyword">end</span>
0111 
0112 <span class="comment">%% Boundary</span>
0113 BoundX1=[];
0114 BoundX2=[];
0115 BoundY1=[];
0116 BoundY2=[];
0117 BoundZ1=[];
0118 BoundZ2=[];
0119 N=size(fiber,2);
0120 <span class="comment">% BoundZ1=[1:N];</span>
0121 <span class="comment">% BoundZ2=[1:N];</span>
0122 <span class="keyword">for</span> i=1:N
0123     <span class="keyword">if</span> (fiber(i).center(1)&lt;=minx+2*fiber(i).radius)
0124         <span class="comment">%     if (fiber(i).center(1)&lt;=1.0*(2*a+fiber(i).radius))</span>
0125         <span class="comment">%fiber1(i).nodes=[fiber1(i).nodes 0]; %left boundary</span>
0126         BoundX1(end+1)=i;
0127     <span class="keyword">end</span>
0128     <span class="keyword">if</span> (fiber(i).center(1)&gt;=maxx-2*fiber(i).radius)
0129         <span class="comment">%fiber1(i).nodes=[fiber1(i).nodes N+1]; % right boundary</span>
0130         BoundX2(end+1)=i;
0131     <span class="keyword">end</span>
0132     <span class="keyword">if</span> (fiber(i).center(2)&lt;=miny+2*fiber(i).radius)
0133         <span class="comment">%fiber1(i).nodes=[fiber1(i).nodes 0]; %left boundary</span>
0134         BoundY1(end+1)=i;
0135     <span class="keyword">end</span>
0136     <span class="keyword">if</span> (fiber(i).center(2)&gt;=maxy-2*fiber(i).radius)
0137         <span class="comment">%fiber1(i).nodes=[fiber1(i).nodes N+1]; % right boundary</span>
0138         BoundY2(end+1)=i;
0139     <span class="keyword">end</span>
0140 <span class="keyword">end</span>
0141 <span class="comment">%% Plot Left-Right BC</span>
0142 <span class="comment">% for xbound=1:size(BoundX1,2)</span>
0143 <span class="comment">%     node=BoundX1(xbound);</span>
0144 <span class="comment">%     plot([minx-fiberRadius fiber(node).center(1)],[fiber(node).center(2) fiber(node).center(2)],'r*-','LineWidth',3);</span>
0145 <span class="comment">% end</span>
0146 <span class="comment">% for xbound=1:size(BoundX2,2)</span>
0147 <span class="comment">%     node=BoundX2(xbound);</span>
0148 <span class="comment">%     plot([maxx+fiberRadius fiber(node).center(1)],[fiber(node).center(2) fiber(node).center(2)],'g*-','LineWidth',3);</span>
0149 <span class="comment">% end</span>
0150 <span class="comment">% %% Plot Top-Bottom BC</span>
0151 <span class="comment">% axis equal</span>
0152 <span class="comment">% for xbound=1:size(BoundY1,2)</span>
0153 <span class="comment">%     node=BoundY1(xbound);</span>
0154 <span class="comment">%     plot([fiber(node).center(1) fiber(node).center(1)],[miny-fiberRadius fiber(node).center(2)],'r*-','LineWidth',3);</span>
0155 <span class="comment">% %     plot([minx-fiberRadius fiber(node).center(1)],[fiber(node).center(2) fiber(node).center(2)],'r*-','LineWidth',3);</span>
0156 <span class="comment">% end</span>
0157 <span class="comment">% for xbound=1:size(BoundY2,2)</span>
0158 <span class="comment">%     node=BoundY2(xbound);</span>
0159 <span class="comment">%     plot([fiber(node).center(1) fiber(node).center(1)],[maxy+fiberRadius fiber(node).center(2)],'g*-','LineWidth',3);</span>
0160 <span class="comment">% %     plot([maxx+fiberRadius fiber(node).center(1)],[fiber(node).center(2) fiber(node).center(2)],'g*-','LineWidth',3);</span>
0161 <span class="comment">% end</span>
0162 <span class="comment">%</span>
0163 fiber(1).contactNeighbor=[];
0164 fiber(1).Contacts=[];
0165 fiber(1).pts=[];
0166 N=size(fiber,2);
0167 
0168 <span class="comment">%ContactLen=beta*a;</span>
0169 <span class="comment">% NumSections=floor(fiberLen/ContactLen);</span>
0170 <span class="comment">%%</span>
0171 <span class="comment">% calculate a using average distance</span>
0172 distances=[];
0173 <span class="keyword">for</span> i=1:N
0174     NumNeighbor=size(fiber(i).nodes,2);
0175     nbdistance=[];
0176     <span class="keyword">for</span> j=1:NumNeighbor    <span class="comment">%contact pts with each neighbor</span>
0177         NeighborNode=fiber(i).nodes(j);
0178         <span class="comment">%% neighbor distance</span>
0179         fiber_d=sqrt((fiber(i).center(1)-fiber(NeighborNode).center(1))^2+(fiber(i).center(2)-fiber(NeighborNode).center(2))^2)-fiber(i).radius-fiber(NeighborNode).radius;
0180         nbdistance=[nbdistance fiber_d];
0181     <span class="keyword">end</span>
0182     fiber(i).nodes_dist=nbdistance;
0183     ave_nbdistance=mean(nbdistance);
0184     fiber(i).ave_dist=ave_nbdistance;
0185     distances=[distances fiber(i).nodes_dist];
0186 <span class="keyword">end</span>
0187 <span class="comment">%max_a=max(distances);</span>
0188 <span class="comment">%fiberLen=ContactsPerFiber*beta*max_a;</span>
0189 L=fiberLen;
0190 <span class="comment">%%</span>
0191 <span class="comment">%L=fiberLen; % fiber length in m</span>
0192 <span class="keyword">for</span> i=1:N
0193     NumNeighbor=size(fiber(i).nodes,2);
0194     allcontact=[];
0195     <span class="keyword">for</span> j=1:NumNeighbor    <span class="comment">%contact pts with each neighbor</span>
0196         contact=[];
0197         NeighborNode=fiber(i).nodes(j);
0198         <span class="comment">% NeighborNode=fiber(i).nodes(j);</span>
0199         <span class="comment">% contact=[];</span>
0200         <span class="comment">%a=fiber(i).nodes_dist(j);</span>
0201         <span class="comment">% a=sqrt((fiber(i).center(1)-fiber(NeighborNode).center(1))^2+(fiber(i).center(2)-fiber(NeighborNode).center(2))^2)-fiber(i).radius-fiber(NeighborNode).radius;</span>
0202         
0203         <span class="comment">%NeighborNode=fiber(i).nodes(j);</span>
0204         <span class="keyword">if</span> NeighborNode&gt;i
0205             a=0.5*(fiber(i).ave_dist+fiber(NeighborNode).ave_dist);
0206             ContactLen=beta*a;
0207             startpt=rand*ContactLen;
0208             endpt=startpt;
0209             <span class="keyword">while</span> endpt&lt;=L
0210                 contact(end+1)=endpt;
0211                 endpt=endpt+ContactLen;
0212             <span class="keyword">end</span>
0213             
0214             <span class="comment">%             NumContacts=floor(L/ContactLen);</span>
0215             <span class="comment">%             previous=rand*ContactLen;</span>
0216             <span class="comment">%             contact(1)=previous;</span>
0217             <span class="comment">%             if NumContacts&gt;=2</span>
0218             <span class="comment">%                 for m=2:NumContacts</span>
0219             <span class="comment">%                     contact(m)=previous+ContactLen; %contact(m)=previous+ContactLen*normrnd(0,0.01);</span>
0220             <span class="comment">%                     previous=contact(m);</span>
0221             <span class="comment">%                 end</span>
0222             <span class="comment">%             end</span>
0223             
0224             sizeb=size(contact,2);
0225             NumContacts=sizeb;
0226             allcontact=[allcontact,contact];  <span class="comment">% all contact points on fiber i</span>
0227             fiber(i).contactNeighbor(end+1:end+sizeb)=NeighborNode;  <span class="comment">%</span>
0228             fiber(NeighborNode).Contacts(end+1:end+sizeb)=contact;
0229             fiber(NeighborNode).contactNeighbor(end+1:end+sizeb)=i;
0230         <span class="keyword">end</span>
0231     <span class="keyword">end</span>
0232     allcontact=[fiber(i).Contacts,allcontact];  <span class="comment">% all contact pts including those inherited from previous fibers (NeighborNode&lt;i)</span>
0233     allcontact1=unique(allcontact);
0234     fiber(i).Contacts=allcontact1;
0235     <span class="keyword">if</span> size(allcontact1,1)~=0
0236         <span class="keyword">for</span> m=1:size(allcontact1,2)   <span class="comment">% find contact neighbors for each contact point.</span>
0237             loc=find(allcontact==allcontact1(m));
0238             fiber(i).pts{m}=fiber(i).contactNeighbor(loc);
0239         <span class="keyword">end</span>
0240     <span class="keyword">end</span>
0241 <span class="keyword">end</span>
0242 <span class="comment">%all fibers built</span>
0243 
0244 <span class="comment">%% consider fiber breakage</span>
0245 <span class="keyword">if</span> NumBreak~=0
0246     <span class="keyword">for</span> i=1:N
0247         iNumBreak=randi(NumBreak,1);
0248         ContactVec=fiber(i).Contacts;
0249         BreakPts=min(ContactVec)+(max(ContactVec)-min(ContactVec))*rand(iNumBreak,1);
0250         BreakPts=unique(BreakPts);
0251         locBP=zeros(iNumBreak,1);
0252         <span class="keyword">for</span> NumBP=1:iNumBreak
0253             locBP(NumBP,1)=find(ContactVec&gt;BreakPts(NumBP),1);
0254         <span class="keyword">end</span>
0255         fiber(i).Breakage=locBP;
0256     <span class="keyword">end</span>
0257 <span class="keyword">end</span>
0258 <span class="comment">%%</span>
0259 R=cell(N,N);
0260 <span class="keyword">for</span> i=1:N
0261     <span class="keyword">for</span> j=1:N
0262         NumRows=size(fiber(i).Contacts,2);
0263         NumColumns=size(fiber(j).Contacts,2);
0264         R{i,j}=zeros(NumRows,NumColumns);
0265     <span class="keyword">end</span>
0266 <span class="keyword">end</span>
0267 G=R;       <span class="comment">% GV=K</span>
0268 <span class="comment">% finish initializing</span>
0269 
0270 <span class="comment">%%% build fibers resistors and contact resistors</span>
0271 fid=fopen(NetListID,<span class="string">'a'</span>);
0272 <span class="comment">% ground</span>
0273 <span class="keyword">for</span> i=1:size(BoundY2,2)
0274     fibernum=BoundY2(i);
0275     <span class="keyword">for</span> j=1:size(fiber( fibernum).Contacts,2)
0276         Rvalue=0.000001;
0277         RID=[<span class="string">'Rg_F'</span> num2str(fibernum) <span class="string">'C'</span> num2str(j)];
0278         Node1=[<span class="string">'F'</span> num2str(fibernum) <span class="string">'C'</span> num2str(j)];
0279         Node2=[num2str(0)];     
0280         fprintf(fid,<span class="string">'%s %s %s %f \n'</span>,RID,Node1,Node2,Rvalue);
0281     <span class="keyword">end</span>
0282 <span class="keyword">end</span>
0283 <span class="comment">% electrode</span>
0284 <span class="keyword">for</span> i=1:size(BoundY1,2)
0285         fibernum=BoundY1(i);
0286     <span class="keyword">for</span> j=1:size(fiber( fibernum).Contacts,2)
0287         <span class="comment">%fibernum=BoundY2(i);</span>
0288         Rvalue=0.000001;
0289         RID=[<span class="string">'Re_F'</span> num2str(fibernum) <span class="string">'C'</span> num2str(j)];
0290         Node1=[<span class="string">'Electrode'</span>];
0291         Node2=[<span class="string">'F'</span> num2str(fibernum) <span class="string">'C'</span> num2str(j)];      
0292         fprintf(fid,<span class="string">'%s %s %s %f \n'</span>,RID,Node1,Node2,Rvalue);
0293     <span class="keyword">end</span>
0294 <span class="keyword">end</span>
0295 <span class="comment">% fiber resistors</span>
0296 <span class="keyword">for</span> i=1:N
0297     NumContacts=size(fiber(i).Contacts,2); <span class="comment">% note Contacts is a row vector</span>
0298     ContactVec=fiber(i).Contacts;
0299     <span class="comment">% R matrix</span>
0300     <span class="comment">% R for fiber sections</span>
0301     <span class="keyword">for</span> j=1:NumContacts-1
0302         RLen=fiber(i).Contacts(j+1)-fiber(i).Contacts(j);
0303         A=pi*fiber(i).radius^2;
0304         Rvalue=rf*RLen/A;
0305         RID=[<span class="string">'R_F'</span> num2str(i) <span class="string">'C'</span> num2str(j)];
0306         Node1=[<span class="string">'F'</span> num2str(i) <span class="string">'C'</span> num2str(j)];
0307         Node2=[<span class="string">'F'</span> num2str(i) <span class="string">'C'</span> num2str(j+1)];      
0308         fprintf(fid,<span class="string">'%s %s %s %f \n'</span>,RID,Node1,Node2,Rvalue);
0309     <span class="keyword">end</span>
0310     <span class="comment">% contact resistors</span>
0311     <span class="keyword">for</span> j=1:NumContacts
0312         num_pt=size(fiber(i).pts{j},2);
0313         <span class="keyword">for</span> k=1:num_pt
0314             neighbor_pt=fiber(i).pts{j}(k);
0315             <span class="keyword">if</span> neighbor_pt&lt;i
0316             ind=find(fiber(neighbor_pt).Contacts==ContactVec(j));           
0317             Rvalue=Rc;
0318             RID=[<span class="string">'Rc_F'</span> num2str(i) <span class="string">'C'</span> num2str(j)];
0319             Node1=[<span class="string">'F'</span> num2str(i) <span class="string">'C'</span> num2str(j)];
0320             Node2=[<span class="string">'F'</span> num2str(neighbor_pt) <span class="string">'C'</span> num2str(ind)];
0321             fprintf(fid,<span class="string">'%s %s %s %f \n'</span>,RID,Node1,Node2,Rvalue);
0322             <span class="keyword">end</span>
0323         <span class="keyword">end</span>
0324     <span class="keyword">end</span>
0325 <span class="keyword">end</span>
0326 <span class="comment">%% write analysis command</span>
0327 <span class="comment">%fid=fopen(NetListID,'a');</span>
0328 fprintf(fid,<span class="string">'%s \n'</span>,<span class="string">'Vin Electrode 0 1'</span>);
0329 fprintf(fid,<span class="string">'%s \n'</span>,<span class="string">'.OP'</span>);
0330 <span class="comment">% fprintf(fid,'%s \n','.DC Vinput 1 1 1');</span>
0331 fprintf(fid,<span class="string">'%s \n'</span>,<span class="string">'.PRINT I(Vin)'</span>);
0332 fprintf(fid,<span class="string">'%s \n'</span>,<span class="string">'.END'</span>);
0333 ST = fclose(fid);
0334 
0335 rho=1;
0336 <span class="keyword">if</span> 1==1
0337 <span class="comment">%% run LTspice and get results</span>
0338 SystemCMD = [<span class="string">'scad3.exe'</span>,<span class="string">' -b -ascii '</span>,NetListID];
0339 p=system(SystemCMD);
0340 <span class="comment">%waitfor(p);</span>
0341 filepath = [NetList,<span class="string">'.raw'</span>];
0342 [Iin,Is,data1]=<a href="ReadRAW.html" class="code" title="function [Vin,data,data1]=ReadRAW(infile)">ReadRAW</a>(filepath);
0343 Res=1/abs(Iin)
0344 rho=Res*fiberLen*xlen/ylen
0345 &lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
0346 <span class="keyword">end</span>
0347 =======
0348 <span class="keyword">end</span>
0349 &gt;&gt;&gt;&gt;&gt;&gt;&gt; 558d32ba490f1fcd4af42dcc54ca0581b61ef031</pre></div>
<hr><address>Generated on Thu 11-Feb-2016 12:45:32 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>