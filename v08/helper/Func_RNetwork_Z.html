<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of Func_RNetwork_Z</title>
  <meta name="keywords" content="Func_RNetwork_Z">
  <meta name="description" content="% this function is used when the input fibermat is from generated fiber data (not from SEM).">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">v08</a> &gt; <a href="index.html">helper</a> &gt; Func_RNetwork_Z.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for v08\helper&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>Func_RNetwork_Z
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>% this function is used when the input fibermat is from generated fiber data (not from SEM).</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [rho,fiber,VF,NumContacts]=Func_RNetwork_Z(fibermat,fiberLen,beta,fiberRadius,NumBreak,Rc,rf,RBreakage) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">% this function is used when the input fibermat is from generated fiber data (not from SEM). 
  fibermat data structure: fiber.x, fiber.y,fiber.radius
% load data; scale data.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="createnode.html" class="code" title="function [ nodes ] = createnode( fiber,ref,perc,N )">createnode</a>	UNTITLED2 Summary of this function goes here</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="Interface_layer_simulation.html" class="code" title="">Interface_layer_simulation</a>	% 3D Resistor Network Modle by Hong Yu</li><li><a href="RNetworkGUI1.html" class="code" title="function varargout = RNetworkGUI1(varargin)">RNetworkGUI1</a>	RNETWORKGUI1 MATLAB code for RNetworkGUI1.fig</li><li><a href="RvsPressure2.html" class="code" title="">RvsPressure2</a>	% convergence test: Rz; Square Packing; IM7</li><li><a href="SIM_Compare_Combine_GUI.html" class="code" title="function varargout = SIM_Compare_Combine_GUI(varargin)">SIM_Compare_Combine_GUI</a>	SIM_COMPARE_COMBINE_GUI MATLAB code for SIM_Compare_Combine_GUI.fig</li><li><a href="SIM_Compare_Combine_GUI_table.html" class="code" title="function varargout = SIM_Compare_Combine_GUI_table(varargin)">SIM_Compare_Combine_GUI_table</a>	SIM_COMPARE_COMBINE_GUI_TABLE MATLAB code for SIM_Compare_Combine_GUI_table.fig</li><li><a href="SIM_Compare_GUI.html" class="code" title="function varargout = SIM_Compare_GUI(varargin)">SIM_Compare_GUI</a>	SIM_COMPARE_GUI MATLAB code for SIM_Compare_GUI.fig</li><li><a href="SIM_Compare_Hexagonal_GUI.html" class="code" title="function varargout = SIM_Compare_Hexagonal_GUI(varargin)">SIM_Compare_Hexagonal_GUI</a>	SIM_COMPARE_HEXAGONAL_GUI MATLAB code for SIM_Compare_Hexagonal_GUI.fig</li><li><a href="SIM_Compare_Square_GUI.html" class="code" title="function varargout = SIM_Compare_Square_GUI(varargin)">SIM_Compare_Square_GUI</a>	SIM_COMPARE_SQUARE_GUI MATLAB code for SIM_Compare_Square_GUI.fig</li><li><a href="SIM_Comparison_R_VF_AS4.html" class="code" title="">SIM_Comparison_R_VF_AS4</a>	% convergence test: Rz; Square Packing; IM7</li><li><a href="SIM_Convergence_Square_IM7.html" class="code" title="">SIM_Convergence_Square_IM7</a>	% convergence test: Rz; Square Packing; IM7</li><li><a href="SIM_Convergence_Square_IM7[Conflict 1].html" class="code" title="">SIM_Convergence_Square_IM7[Conflict 1]</a>	% convergence test: Rz; Square Packing; IM7</li><li><a href="SIM_Convergence_Square_IM7[Conflict 2].html" class="code" title="">SIM_Convergence_Square_IM7[Conflict 2]</a>	% convergence test: Rz; Square Packing; IM7</li><li><a href="SIM_Convergence_Square_IM7[Conflict 3].html" class="code" title="">SIM_Convergence_Square_IM7[Conflict 3]</a>	% convergence test: Rz; Square Packing; IM7</li><li><a href="SIM_Convergence_Square_IM7[Conflict].html" class="code" title="">SIM_Convergence_Square_IM7[Conflict]</a>	% convergence test: Rz; Square Packing; IM7</li><li><a href="Sensitivity_Study_Taguchi.html" class="code" title="">Sensitivity_Study_Taguchi</a>	% Sensitivity study of 3D Resistor Network MOdel using Taguchi Technique</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [rho,fiber,VF,NumContacts]=Func_RNetwork_Z(fibermat,fiberLen,beta,fiberRadius,NumBreak,Rc,rf,RBreakage)</a>
0002 <span class="comment">%% this function is used when the input fibermat is from generated fiber data (not from SEM).</span>
0003 <span class="comment">%  fibermat data structure: fiber.x, fiber.y,fiber.radius</span>
0004 <span class="comment">%% load data; scale data.</span>
0005 NumContacts=0;
0006 <span class="comment">%load('vf_0.6_spec2.mat'); % changed from fibermat to 'vf_0.6_spec2.mat'</span>
0007 <span class="comment">% Note: after load(fibermat), fiber.x fiber.y fiber.z are all row vectors.</span>
0008 <span class="comment">% Code below change row vectors into column vectors.</span>
0009 fiber.x=fiber.x';
0010 fiber.y=fiber.y';
0011 fiber.radius=fiber.radius';
0012 <span class="comment">% Now fiber.x fiber.y and fiber.radius are column vectors.</span>
0013 N=size(fiber.radius,1);<span class="comment">%</span>
0014 <span class="comment">% !!! be careful, depending on the fiber.radius being a row vector or</span>
0015 <span class="comment">% column vector, this command can be size(...,2) for row vector</span>
0016 <span class="comment">%or size(...,1) for column vectors.</span>
0017 fiber1= struct(<span class="string">'center'</span>,[], <span class="string">'radius'</span>,[], <span class="string">'nodes'</span>, []);
0018 aveRad=mean(fiber.radius);
0019 scale=aveRad/fiberRadius;
0020 
0021 fiber.x=fiber.x/scale;
0022 fiber.y=fiber.y/scale;
0023 fiber.radius=fiber.radius/scale;
0024 <span class="comment">%% get VF and a</span>
0025 minx=min(fiber.x)-fiberRadius;
0026 miny=min(fiber.y)-fiberRadius;
0027 maxx=max(fiber.x)+fiberRadius;
0028 maxy=max(fiber.y)+fiberRadius;
0029 xlen=maxx-minx;
0030 ylen=maxy-miny;
0031 <span class="comment">% xlen=maxx-minx-2*fiberRadius;</span>
0032 <span class="comment">% ylen=maxy-miny-2*fiberRadius;</span>
0033 Rsquare=fiber.radius'*fiber.radius;
0034 VF=pi*Rsquare/(xlen*ylen);
0035 <span class="comment">%a=fiberRadius*(sqrt(pi/(VF))-2); % square packing</span>
0036 <span class="comment">% a=fiberRadius*(sqrt(2*pi/(sqrt(3)*VF))-2); % hex packing</span>
0037 <span class="comment">%% plot</span>
0038 <span class="comment">% clf</span>
0039 <span class="comment">% hold on</span>
0040 <span class="comment">% viscircles([fiber.x fiber.y],fiber.radius,'LineWidth',2);</span>
0041 <span class="comment">% axis([minx maxx miny maxy]);</span>
0042 <span class="comment">%% restruct data</span>
0043 <span class="keyword">for</span> i=1:N
0044     fiber1(i).center(1)=fiber.x(i);
0045     fiber1(i).center(2)=fiber.y(i);
0046     fiber1(i).radius=fiber.radius(i);
0047 <span class="keyword">end</span>
0048 fiber=fiber1;
0049 <span class="comment">%% find fiber neigbbors</span>
0050 perc=1.8*fiberRadius;
0051 <span class="keyword">for</span> i=1:N
0052     fiber(i).nodes=<a href="createnode.html" class="code" title="function [ nodes ] = createnode( fiber,ref,perc,N )">createnode</a>(fiber,i,perc,N);
0053 <span class="keyword">end</span>
0054 <span class="comment">% finish creating neighbors</span>
0055 <span class="comment">% find floating fibers that are not connected to any fibers</span>
0056 nullnodes=[];
0057 <span class="keyword">for</span> i=1:N
0058     <span class="keyword">if</span> size(fiber(i).nodes,2)==0
0059         nullnodes(end+1)=i;
0060     <span class="keyword">end</span>
0061 <span class="keyword">end</span>
0062 <span class="keyword">while</span> ~isempty(nullnodes)
0063     fiber(nullnodes(1))=[];
0064     N1=size(fiber,2)
0065     <span class="keyword">for</span> i=1:N1
0066         fiber(i).nodes=<a href="createnode.html" class="code" title="function [ nodes ] = createnode( fiber,ref,perc,N )">createnode</a>(fiber,i,perc,N1);
0067     <span class="keyword">end</span>
0068     nullnodes=[];
0069     <span class="keyword">for</span> i=1:N1
0070         <span class="keyword">if</span> size(fiber(i).nodes,2)==0
0071             nullnodes(end+1)=i;            
0072         <span class="keyword">end</span>
0073     <span class="keyword">end</span>
0074 <span class="keyword">end</span>
0075 
0076 <span class="comment">%% Boundary</span>
0077 BoundX1=[];
0078 BoundX2=[];
0079 BoundY1=[];
0080 BoundY2=[];
0081 BoundZ1=[];
0082 BoundZ2=[];
0083 N=size(fiber,2);
0084 <span class="comment">% BoundZ1=[1:N];</span>
0085 <span class="comment">% BoundZ2=[1:N];</span>
0086 <span class="keyword">for</span> i=1:N
0087     <span class="keyword">if</span> (fiber(i).center(1)&lt;=minx+2*fiber(i).radius)
0088 <span class="comment">%     if (fiber(i).center(1)&lt;=1.0*(2*a+fiber(i).radius))</span>
0089         <span class="comment">%fiber1(i).nodes=[fiber1(i).nodes 0]; %left boundary</span>
0090         BoundX1(end+1)=i;
0091     <span class="keyword">end</span>
0092     <span class="keyword">if</span> (fiber(i).center(1)&gt;=maxx-2*fiber(i).radius)
0093         <span class="comment">%fiber1(i).nodes=[fiber1(i).nodes N+1]; % right boundary</span>
0094         BoundX2(end+1)=i;
0095     <span class="keyword">end</span>
0096     <span class="keyword">if</span> (fiber(i).center(2)&lt;=miny+2*fiber(i).radius)
0097         <span class="comment">%fiber1(i).nodes=[fiber1(i).nodes 0]; %left boundary</span>
0098         BoundY1(end+1)=i;
0099     <span class="keyword">end</span>
0100     <span class="keyword">if</span> (fiber(i).center(2)&gt;=maxy-2*fiber(i).radius)
0101         <span class="comment">%fiber1(i).nodes=[fiber1(i).nodes N+1]; % right boundary</span>
0102         BoundY2(end+1)=i;
0103     <span class="keyword">end</span>
0104 <span class="keyword">end</span>
0105 <span class="comment">%% Plot Left-Right BC</span>
0106 <span class="comment">% for xbound=1:size(BoundX1,2)</span>
0107 <span class="comment">%     node=BoundX1(xbound);</span>
0108 <span class="comment">%     plot([minx-fiberRadius fiber(node).center(1)],[fiber(node).center(2) fiber(node).center(2)],'r*-','LineWidth',3);</span>
0109 <span class="comment">% end</span>
0110 <span class="comment">% for xbound=1:size(BoundX2,2)</span>
0111 <span class="comment">%     node=BoundX2(xbound);</span>
0112 <span class="comment">%     plot([maxx+fiberRadius fiber(node).center(1)],[fiber(node).center(2) fiber(node).center(2)],'g*-','LineWidth',3);</span>
0113 <span class="comment">% end</span>
0114 <span class="comment">% %% Plot Top-Bottom BC</span>
0115 <span class="comment">% axis equal</span>
0116 <span class="comment">% for xbound=1:size(BoundY1,2)</span>
0117 <span class="comment">%     node=BoundY1(xbound);</span>
0118 <span class="comment">%     plot([fiber(node).center(1) fiber(node).center(1)],[miny-fiberRadius fiber(node).center(2)],'r*-','LineWidth',3);</span>
0119 <span class="comment">% %     plot([minx-fiberRadius fiber(node).center(1)],[fiber(node).center(2) fiber(node).center(2)],'r*-','LineWidth',3);</span>
0120 <span class="comment">% end</span>
0121 <span class="comment">% for xbound=1:size(BoundY2,2)</span>
0122 <span class="comment">%     node=BoundY2(xbound);</span>
0123 <span class="comment">%     plot([fiber(node).center(1) fiber(node).center(1)],[maxy+fiberRadius fiber(node).center(2)],'g*-','LineWidth',3);</span>
0124 <span class="comment">% %     plot([maxx+fiberRadius fiber(node).center(1)],[fiber(node).center(2) fiber(node).center(2)],'g*-','LineWidth',3);</span>
0125 <span class="comment">% end</span>
0126 <span class="comment">%</span>
0127 fiber(1).contactNeighbor=[];
0128 fiber(1).Contacts=[];
0129 fiber(1).pts=[];
0130 N=size(fiber,2);
0131 
0132 <span class="comment">%ContactLen=beta*a;</span>
0133 <span class="comment">% NumSections=floor(fiberLen/ContactLen);</span>
0134 <span class="comment">%%</span>
0135 <span class="comment">% calculate a using average distance</span>
0136 distances=[];
0137 <span class="keyword">for</span> i=1:N
0138     NumNeighbor=size(fiber(i).nodes,2);
0139     nbdistance=[];
0140     <span class="keyword">for</span> j=1:NumNeighbor    <span class="comment">%contact pts with each neighbor</span>
0141         NeighborNode=fiber(i).nodes(j);
0142         <span class="comment">%% neighbor distance</span>
0143         fiber_d=sqrt((fiber(i).center(1)-fiber(NeighborNode).center(1))^2+(fiber(i).center(2)-fiber(NeighborNode).center(2))^2)-fiber(i).radius-fiber(NeighborNode).radius;
0144         nbdistance=[nbdistance fiber_d];
0145     <span class="keyword">end</span>
0146     fiber(i).nodes_dist=nbdistance;
0147     ave_nbdistance=mean(nbdistance);
0148     fiber(i).ave_dist=ave_nbdistance;
0149     distances=[distances fiber(i).nodes_dist];
0150 <span class="keyword">end</span>
0151 <span class="comment">%max_a=max(distances);</span>
0152 <span class="comment">%fiberLen=ContactsPerFiber*beta*max_a;</span>
0153 L=fiberLen;
0154 <span class="comment">%%</span>
0155 <span class="comment">%L=fiberLen; % fiber length in m</span>
0156 <span class="keyword">for</span> i=1:N
0157     NumNeighbor=size(fiber(i).nodes,2);
0158     allcontact=[];
0159     <span class="keyword">for</span> j=1:NumNeighbor    <span class="comment">%contact pts with each neighbor</span>
0160         contact=[]; 
0161         NeighborNode=fiber(i).nodes(j);        
0162         <span class="comment">% NeighborNode=fiber(i).nodes(j);</span>
0163         <span class="comment">% contact=[];</span>
0164         <span class="comment">%a=fiber(i).nodes_dist(j);</span>
0165         <span class="comment">% a=sqrt((fiber(i).center(1)-fiber(NeighborNode).center(1))^2+(fiber(i).center(2)-fiber(NeighborNode).center(2))^2)-fiber(i).radius-fiber(NeighborNode).radius;</span>
0166              
0167         <span class="comment">%NeighborNode=fiber(i).nodes(j);</span>
0168         <span class="keyword">if</span> NeighborNode&gt;i
0169             a=0.5*(fiber(i).ave_dist+fiber(NeighborNode).ave_dist);
0170             ContactLen=beta*a;
0171             startpt=rand*ContactLen;
0172             endpt=startpt;
0173             <span class="keyword">while</span> endpt&lt;=L
0174                 contact(end+1)=endpt;
0175                 endpt=endpt+ContactLen;
0176             <span class="keyword">end</span>        
0177             
0178 <span class="comment">%             NumContacts=floor(L/ContactLen);</span>
0179 <span class="comment">%             previous=rand*ContactLen;</span>
0180 <span class="comment">%             contact(1)=previous;</span>
0181 <span class="comment">%             if NumContacts&gt;=2</span>
0182 <span class="comment">%                 for m=2:NumContacts</span>
0183 <span class="comment">%                     contact(m)=previous+ContactLen; %contact(m)=previous+ContactLen*normrnd(0,0.01);</span>
0184 <span class="comment">%                     previous=contact(m);</span>
0185 <span class="comment">%                 end</span>
0186 <span class="comment">%             end</span>
0187             
0188             sizeb=size(contact,2);
0189             NumContacts=sizeb;
0190             allcontact=[allcontact,contact];  <span class="comment">% all contact points on fiber i</span>
0191             fiber(i).contactNeighbor(end+1:end+sizeb)=NeighborNode;  <span class="comment">%</span>
0192             fiber(NeighborNode).Contacts(end+1:end+sizeb)=contact;
0193             fiber(NeighborNode).contactNeighbor(end+1:end+sizeb)=i;
0194         <span class="keyword">end</span>
0195     <span class="keyword">end</span>
0196     allcontact=[fiber(i).Contacts,allcontact];  <span class="comment">% all contact pts including those inherited from previous fibers (NeighborNode&lt;i)</span>
0197     allcontact1=unique(allcontact);
0198     fiber(i).Contacts=allcontact1;
0199     <span class="keyword">if</span> size(allcontact1,1)~=0
0200         <span class="keyword">for</span> m=1:size(allcontact1,2)   <span class="comment">% find contact neighbors for each contact point.</span>
0201             loc=find(allcontact==allcontact1(m));
0202             fiber(i).pts{m}=fiber(i).contactNeighbor(loc);
0203         <span class="keyword">end</span>
0204     <span class="keyword">end</span>
0205 <span class="keyword">end</span>    <span class="comment">%all fibers built</span>
0206 
0207 <span class="comment">%             end</span>
0208 <span class="comment">%             if curr_node==N+1</span>
0209 <span class="comment">%                  plot([fiber(i).center(1) max_x],[fiber(i).center(2) fiber(i).center(2)],'r*-','LineWidth',3);</span>
0210 <span class="comment">%</span>
0211 <span class="comment">%             end</span>
0212 <span class="comment">% fiber.BoundX1=BoundX1;</span>
0213 <span class="comment">% fiber.BoundX2=BoundX2;</span>
0214 <span class="comment">% fiber.BoundY1=BoundY1;</span>
0215 <span class="comment">% fiber.BoundY2=BoundY2;</span>
0216 
0217 <span class="comment">% finish finding BC nodes</span>
0218 
0219 <span class="comment">%%% consider fiber breakage</span>
0220 <span class="keyword">if</span> NumBreak~=0
0221 <span class="keyword">for</span> i=1:N
0222     iNumBreak=randi(NumBreak,1);
0223     ContactVec=fiber(i).Contacts;
0224     BreakPts=min(ContactVec)+(max(ContactVec)-min(ContactVec))*rand(iNumBreak,1);
0225     BreakPts=unique(BreakPts);
0226     locBP=zeros(iNumBreak,1);
0227     <span class="keyword">for</span> NumBP=1:iNumBreak       
0228         locBP(NumBP,1)=find(ContactVec&gt;BreakPts(NumBP),1);
0229     <span class="keyword">end</span>
0230     fiber(i).Breakage=locBP;
0231 <span class="keyword">end</span>
0232 <span class="keyword">end</span>
0233 <span class="comment">%%</span>
0234 R=cell(N,N);
0235 <span class="keyword">for</span> i=1:N
0236     <span class="keyword">for</span> j=1:N
0237         NumRows=size(fiber(i).Contacts,2);
0238         NumColumns=size(fiber(j).Contacts,2);
0239         R{i,j}=zeros(NumRows,NumColumns);
0240     <span class="keyword">end</span>
0241 <span class="keyword">end</span>
0242 G=R;       <span class="comment">% GV=K</span>
0243 <span class="comment">% finish initializing</span>
0244 
0245 <span class="comment">%%% build fibers resistors and contact resistors</span>
0246 <span class="keyword">for</span> i=1:N
0247     NumContacts=size(fiber(i).Contacts,2); <span class="comment">% note Contacts is a row vector</span>
0248     ContactVec=fiber(i).Contacts;
0249     <span class="comment">% R matrix</span>
0250     <span class="comment">% R for fiber sections</span>
0251     <span class="keyword">for</span> j=1:NumContacts-1
0252          RLen=fiber(i).Contacts(j+1)-fiber(i).Contacts(j);
0253             A=pi*fiber(i).radius^2;
0254             R{i,i}(j,j+1)=rf*RLen/A;
0255             R{i,i}(j+1,j)=rf*RLen/A;    <span class="comment">% resistance between two sections on one fiber</span>
0256             G{i,i}(j,j+1)=-1/R{i,i}(j,j+1);<span class="comment">% G(i,j)=-1/R</span>
0257             G{i,i}(j+1,j)=-1/R{i,i}(j+1,j);<span class="comment">% G(i,j)=-1/R</span>
0258     <span class="keyword">end</span>
0259      <span class="comment">%%%% change R into a large value where fiber breakage happens.</span>
0260      <span class="keyword">if</span> NumBreak
0261      <span class="keyword">for</span> NumBP=1:size(fiber(i).Breakage,1)
0262          BreakLoc=fiber(i).Breakage(NumBP);
0263          R{i,i}(BreakLoc-1,BreakLoc)=RBreakage;
0264          R{i,i}(BreakLoc,BreakLoc-1)=RBreakage;
0265          G{i,i}(BreakLoc-1,BreakLoc)=-1/RBreakage;<span class="comment">% G(i,j)=-1/R</span>
0266          G{i,i}(BreakLoc,BreakLoc-1)=-1/RBreakage;<span class="comment">% G(i,j)=-1/R</span>
0267      <span class="keyword">end</span>
0268      <span class="keyword">end</span>
0269     <span class="comment">% R for contacts</span>
0270     <span class="keyword">for</span> j=1:NumContacts
0271                   num_pt=size(fiber(i).pts{j},2);
0272             <span class="keyword">for</span> k=1:num_pt
0273                 neighbor_pt=fiber(i).pts{j}(k);
0274                 ind=find(fiber(neighbor_pt).Contacts==ContactVec(j));
0275                 R{i,neighbor_pt}(j,ind)=Rc; <span class="comment">%Contact Resistance between fibers</span>
0276                 G{i,neighbor_pt}(j,ind)=-1/Rc;
0277             <span class="keyword">end</span>
0278             fiberi=R{i,i}(j,:);
0279             fiberi=fiberi(fiberi~=0);
0280             sum=0;
0281             <span class="keyword">for</span> m=1:size(fiberi,2)
0282                 sum=sum+1/fiberi(m);
0283             <span class="keyword">end</span>
0284             Gfiberi=sum;
0285             sum1=0;
0286             <span class="keyword">for</span> n=1:num_pt
0287                 neighbor_pt=fiber(i).pts{j}(n);
0288                 ind=find(fiber(neighbor_pt).Contacts==ContactVec(j));
0289                 sum1=sum1+1/R{i,neighbor_pt}(j,ind);
0290             <span class="keyword">end</span>
0291             Gfiberj=sum1;
0292             G{i,i}(j,j)=Gfiberi+Gfiberj;    
0293     <span class="keyword">end</span>
0294 <span class="keyword">end</span>
0295 
0296 <span class="comment">%%%% change R into a large value where fiber breakage happens.</span>
0297 
0298 <span class="comment">% change R into a matrix to apply Kirchoff's Law.</span>
0299 
0300 <span class="comment">%% Apply longitudinal BC</span>
0301 <span class="comment">% BC1=5;</span>
0302 <span class="comment">% BC2=0;</span>
0303 <span class="comment">% for i=1:N</span>
0304 <span class="comment">%     K{i,1}=zeros(size(fiber(i).Contacts,2),1);</span>
0305 <span class="comment">% end</span>
0306 <span class="comment">% for i=1:N %size(BoundZ1,2)</span>
0307 <span class="comment">%     Ki=zeros(size(fiber(i).Contacts,2),1);</span>
0308 <span class="comment">%     Ki(1)=BC1;</span>
0309 <span class="comment">%     Ki(end)=BC2; %% boundary condition</span>
0310 <span class="comment">%     K{i,1}=Ki;</span>
0311 <span class="comment">% end</span>
0312 <span class="comment">% for i=1:N</span>
0313 <span class="comment">%     %Ncontacts=size(fiber(i).Contacts,2);</span>
0314 <span class="comment">%     for j=1:N</span>
0315 <span class="comment">%         G{i,j}(1,:)=0;</span>
0316 <span class="comment">%         G{i,j}(end,:)=0;</span>
0317 <span class="comment">%     end</span>
0318 <span class="comment">% end</span>
0319 <span class="comment">% for i=1:N</span>
0320 <span class="comment">%     G{i,i}(1,1)=1;</span>
0321 <span class="comment">%     G{i,i}(end,end)=1;</span>
0322 <span class="comment">% end</span>
0323 <span class="comment">%% Apply through-thickness BC</span>
0324 rous=[];
0325 K=cell(N,1);
0326 BC1=5;
0327 BC2=0;
0328 <span class="keyword">for</span> i=1:N
0329     K{i,1}=zeros(size(fiber(i).Contacts,2),1);
0330 <span class="keyword">end</span>
0331 <span class="comment">% K=zeros(size(R,1),1)</span>
0332 <span class="comment">%% Apply V from top to bottom</span>
0333 <span class="keyword">for</span> i=1:size(BoundY1,2)
0334     K{BoundY1(i),1}=BC1*ones(size(fiber(BoundY1(i)).Contacts,2),1);<span class="comment">%% boundary condition</span>
0335     fiberlabel=BoundY1(i);
0336     <span class="keyword">for</span> j=1:N
0337         <span class="keyword">if</span> j==fiberlabel
0338             G{fiberlabel,j}=eye(size(fiber(fiberlabel).Contacts,2));
0339         <span class="keyword">else</span>
0340             G{fiberlabel,j}=zeros(size(fiber(fiberlabel).Contacts,2),size(fiber(j).Contacts,2));
0341         <span class="keyword">end</span>
0342     <span class="keyword">end</span>
0343     <span class="comment">%     for j=1:size(fiber(BoundX1(i)).Contacts,1)</span>
0344     <span class="comment">%     G{fiberlabel,fiberlabel}(j,j)=1;</span>
0345     <span class="comment">%     end</span>
0346 <span class="keyword">end</span>
0347 <span class="keyword">for</span> i=1:size(BoundY2,2)
0348     K{BoundY2(i),1}=BC2*ones(size(fiber(BoundY2(i)).Contacts,2),1);
0349     fiberlabel=BoundY2(i);
0350     <span class="keyword">for</span> j=1:N
0351         <span class="keyword">if</span> j==fiberlabel
0352             G{fiberlabel,j}=eye(size(fiber(fiberlabel).Contacts,2));
0353         <span class="keyword">else</span>
0354             G{fiberlabel,j}=zeros(size(fiber(fiberlabel).Contacts,2),size(fiber(j).Contacts,2));
0355         <span class="keyword">end</span>
0356     <span class="keyword">end</span>
0357     <span class="comment">%     for j=1:size(fiber(BoundX2(i)).Contacts,1)</span>
0358     <span class="comment">%     G{fiberlabel,fiberlabel}(j,j)=1;</span>
0359     <span class="comment">%     end</span>
0360 <span class="keyword">end</span>
0361 <span class="comment">%% Apply V from left to right</span>
0362 <span class="comment">% for i=1:size(BoundX1,2)</span>
0363 <span class="comment">%     K{BoundX1(i),1}=BC1*ones(size(fiber(BoundX1(i)).Contacts,2),1);%% boundary condition</span>
0364 <span class="comment">%     fiberlabel=BoundX1(i);</span>
0365 <span class="comment">%     for j=1:N</span>
0366 <span class="comment">%         if j==fiberlabel</span>
0367 <span class="comment">%             G{fiberlabel,j}=eye(size(fiber(fiberlabel).Contacts,2));</span>
0368 <span class="comment">%         else</span>
0369 <span class="comment">%             G{fiberlabel,j}=zeros(size(fiber(fiberlabel).Contacts,2),size(fiber(j).Contacts,2));</span>
0370 <span class="comment">%         end</span>
0371 <span class="comment">%     end</span>
0372 <span class="comment">%     %     for j=1:size(fiber(BoundX1(i)).Contacts,1)</span>
0373 <span class="comment">%     %     G{fiberlabel,fiberlabel}(j,j)=1;</span>
0374 <span class="comment">%     %     end</span>
0375 <span class="comment">% end</span>
0376 <span class="comment">% for i=1:size(BoundX2,2)</span>
0377 <span class="comment">%     K{BoundX2(i),1}=BC2*ones(size(fiber(BoundX2(i)).Contacts,2),1);</span>
0378 <span class="comment">%     fiberlabel=BoundX2(i);</span>
0379 <span class="comment">%     for j=1:N</span>
0380 <span class="comment">%         if j==fiberlabel</span>
0381 <span class="comment">%             G{fiberlabel,j}=eye(size(fiber(fiberlabel).Contacts,2));</span>
0382 <span class="comment">%         else</span>
0383 <span class="comment">%             G{fiberlabel,j}=zeros(size(fiber(fiberlabel).Contacts,2),size(fiber(j).Contacts,2));</span>
0384 <span class="comment">%         end</span>
0385 <span class="comment">%     end</span>
0386 <span class="comment">%     %     for j=1:size(fiber(BoundX2(i)).Contacts,1)</span>
0387 <span class="comment">%     %     G{fiberlabel,fiberlabel}(j,j)=1;</span>
0388 <span class="comment">%     %     end</span>
0389 <span class="comment">% end</span>
0390 <span class="comment">%% Solve GV=K</span>
0391 K=cell2mat(K);
0392 <span class="comment">%R=cell2mat(R);</span>
0393 G=cell2mat(G);
0394 Voltage2=G\K;
0395 Mrow=zeros(N,1);
0396 <span class="keyword">for</span> i=1:N
0397     Mrow(i)=size(fiber(i).Contacts,2);
0398 <span class="keyword">end</span>
0399 Voltage3=mat2cell(Voltage2,Mrow);
0400 <span class="comment">%% calculate longitudinal currents</span>
0401 <span class="comment">% totcur1=0;</span>
0402 <span class="comment">% totcur2=0;</span>
0403 <span class="comment">% cur1=[];</span>
0404 <span class="comment">% cur2=[];</span>
0405 <span class="comment">% for i=1:N</span>
0406 <span class="comment">%     Res1=R{i,i}(1,2);</span>
0407 <span class="comment">%     Vdiff1=BC1-Voltage3{i}(2);</span>
0408 <span class="comment">%     cur1(end+1)=Vdiff1/Res1;</span>
0409 <span class="comment">%     % injecting current</span>
0410 <span class="comment">%     Res2=R{i,i}(end-1,end);</span>
0411 <span class="comment">%     Vdiff2=Voltage3{i}(end)-BC2;</span>
0412 <span class="comment">%     cur2(end+1)=Vdiff2/Res2;</span>
0413 <span class="comment">%     % outgoing current</span>
0414 <span class="comment">%     totcur1=totcur1+cur1(end);</span>
0415 <span class="comment">%     totcur2=totcur2+cur2(end);</span>
0416 <span class="comment">% end</span>
0417 <span class="comment">% Res=(BC1-BC2)/totcur1;</span>
0418 <span class="comment">% rho=xlen*Res*ylen/fiberLen;</span>
0419 
0420 <span class="comment">%% calculate inplane transverse (Y) currents</span>
0421 <span class="comment">% 1. incoming currents</span>
0422 totcur1=0;
0423 totcur2=0;
0424 cur1=[];
0425 cur2=[];
0426 <span class="keyword">for</span> i=1:size(BoundY1,2)
0427     fiberlabel=BoundY1(i);
0428     num_pt=size(fiber(fiberlabel).Contacts,2);
0429     <span class="keyword">for</span> j=1:num_pt
0430         <span class="comment">%Vdiff=BC1-Voltage3{j}</span>
0431         num_contact=size(fiber(fiberlabel).pts{j},2);
0432         <span class="keyword">for</span> k=1:num_contact
0433             neighbor_fiber=fiber(fiberlabel).pts{j}(k);
0434             neighbor_pt=find(fiber(neighbor_fiber).Contacts==fiber(fiberlabel).Contacts(j));
0435             Vdiff=BC1-Voltage3{neighbor_fiber}(neighbor_pt);
0436             Res=R{fiberlabel,neighbor_fiber}(j,neighbor_pt);
0437             cur1(end+1)=Vdiff/Res;
0438             totcur1=totcur1+cur1(end);
0439         <span class="keyword">end</span>
0440     <span class="keyword">end</span>
0441 <span class="keyword">end</span>
0442 <span class="comment">% 2. outgoing current</span>
0443 <span class="keyword">for</span> i=1:size(BoundY2,2)
0444     fiberlabel=BoundY2(i);
0445     num_pt=size(fiber(fiberlabel).Contacts,2);
0446     <span class="keyword">for</span> j=1:num_pt
0447         <span class="comment">%Vdiff=BC1-Voltage3{j}</span>
0448         num_contact=size(fiber(fiberlabel).pts{j},2);
0449         <span class="keyword">for</span> k=1:num_contact
0450             neighbor_fiber=fiber(fiberlabel).pts{j}(k);
0451             neighbor_pt=find(fiber(neighbor_fiber).Contacts==fiber(fiberlabel).Contacts(j));
0452             Vdiff=Voltage3{neighbor_fiber}(neighbor_pt)-BC2;
0453             Res=R{fiberlabel,neighbor_fiber}(j,neighbor_pt);
0454             cur2(end+1)=Vdiff/Res;
0455             totcur2=totcur2+cur2(end);
0456         <span class="keyword">end</span>
0457     <span class="keyword">end</span>
0458 <span class="keyword">end</span>
0459 totcur1;
0460 totcur2;
0461 Res=(BC1-BC2)/totcur1;
0462 rho=fiberLen*Res*xlen/ylen;
0463 <span class="comment">%% calculate through-thickness (Z) currents</span>
0464 <span class="comment">% % 1. outgoing currents</span>
0465 <span class="comment">% totcur1=0;</span>
0466 <span class="comment">% totcur2=0;</span>
0467 <span class="comment">% cur1=[];</span>
0468 <span class="comment">% cur2=[];</span>
0469 <span class="comment">% for i=1:size(BoundX1,2)</span>
0470 <span class="comment">%     fiberlabel=BoundX1(i);</span>
0471 <span class="comment">%     num_pt=size(fiber(fiberlabel).Contacts,2);</span>
0472 <span class="comment">%     for j=1:num_pt</span>
0473 <span class="comment">%         %Vdiff=BC1-Voltage3{j}</span>
0474 <span class="comment">%         num_contact=size(fiber(fiberlabel).pts{j},2);</span>
0475 <span class="comment">%         for k=1:num_contact</span>
0476 <span class="comment">%             neighbor_fiber=fiber(fiberlabel).pts{j}(k);</span>
0477 <span class="comment">%             neighbor_pt=find(fiber(neighbor_fiber).Contacts==fiber(fiberlabel).Contacts(j));</span>
0478 <span class="comment">%             Vdiff=BC1-Voltage3{neighbor_fiber}(neighbor_pt);</span>
0479 <span class="comment">%             Res=R{fiberlabel,neighbor_fiber}(j,neighbor_pt);</span>
0480 <span class="comment">%             cur1(end+1)=Vdiff/Res;</span>
0481 <span class="comment">%             totcur1=totcur1+cur1(end);</span>
0482 <span class="comment">%         end</span>
0483 <span class="comment">%     end</span>
0484 <span class="comment">% end</span>
0485 <span class="comment">% for i=1:size(BoundX2,2)</span>
0486 <span class="comment">%     fiberlabel=BoundX2(i);</span>
0487 <span class="comment">%     num_pt=size(fiber(fiberlabel).Contacts,2);</span>
0488 <span class="comment">%     for j=1:num_pt</span>
0489 <span class="comment">%         %Vdiff=BC1-Voltage3{j}</span>
0490 <span class="comment">%         num_contact=size(fiber(fiberlabel).pts{j},2);</span>
0491 <span class="comment">%         for k=1:num_contact</span>
0492 <span class="comment">%             neighbor_fiber=fiber(fiberlabel).pts{j}(k);</span>
0493 <span class="comment">%             neighbor_pt=find(fiber(neighbor_fiber).Contacts==fiber(fiberlabel).Contacts(j));</span>
0494 <span class="comment">%             Vdiff=Voltage3{neighbor_fiber}(neighbor_pt)-BC2;</span>
0495 <span class="comment">%             Res=R{fiberlabel,neighbor_fiber}(j,neighbor_pt);</span>
0496 <span class="comment">%             cur2(end+1)=Vdiff/Res;</span>
0497 <span class="comment">%             totcur2=totcur2+cur2(end);</span>
0498 <span class="comment">%         end</span>
0499 <span class="comment">%     end</span>
0500 <span class="comment">% end</span>
0501 <span class="comment">% totcur1;</span>
0502 <span class="comment">% totcur2;</span>
0503 <span class="comment">% Res=5/totcur1;</span>
0504 <span class="comment">% rho=fiberLen*Res*ylen/xlen;</span>
0505 <span class="comment">% % save ResData</span>
0506 
0507</pre></div>
<hr><address>Generated on Thu 11-Feb-2016 12:45:32 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>